name: ğŸš€ LINUX VPS SERVER (Terminal Only)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Usage Duration'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Linux-VPS-Setup:
    runs-on: ubuntu-latest
    timeout-minutes: 340
    
    steps:
      - name: ğŸ¯ SYSTEM STARTUP
        run: |
          echo -e "\033[1;33mğŸ¤– AI STV LINUX VPS (CLI)\033[0m"
          echo -e "\033[1;32mâš¡ Powered by AI STV\033[0m"
          echo -e "\033[1;35mğŸ•’ Duration: ${{ github.event.inputs.duration }}\033[0m"
          echo -e "\nâœ… System is ready!"

      - name: ğŸ‘¤ CREATE ADMIN ACCOUNT
        run: |
          # Generar contraseÃ±a aleatoria
          PASSWORD=$(tr -dc A-Za-z0-9 </dev/urandom | head -c 12 ; echo '')
          
          # Crear usuario con privilegios sudo
          sudo useradd -m -s /bin/bash AISTV-ADMIN
          echo "AISTV-ADMIN:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo AISTV-ADMIN
          
          # Guardar datos para el resumen final
          echo "VPS_USER=AISTV-ADMIN" >> $GITHUB_ENV
          echo "VPS_PASS=$PASSWORD" >> $GITHUB_ENV
          echo "$PASSWORD" > /tmp/vps_password.txt

      - name: ğŸŒ SETUP TAILSCALE
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          # Instalar y conectar Tailscale
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=ai-linux-vps-${{ github.run_id }}
          
          IP=$(tailscale ip -4)
          echo "TAILSCALE_IP=$IP" >> $GITHUB_ENV

      - name: ğŸ‰ CONNECTION INFORMATION
        run: |
          PASSWORD=$(cat /tmp/vps_password.txt)
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚           ğŸ‰ VPS SETUP COMPLETE!          â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ ğŸŒ SSH Address: $TAILSCALE_IP"
          echo "â”‚ ğŸ‘¤ Username:    AISTV-ADMIN"
          echo "â”‚ ğŸ” Password:    $PASSWORD"
          echo "â”‚ ğŸ“ SSH Port:    22                        â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ ğŸ’¡ Instructions:                          â”‚"
          echo "â”‚   1. Open your terminal (CMD/PowerShell)  â”‚"
          echo "â”‚   2. Type: ssh AISTV-ADMIN@$TAILSCALE_IP  â”‚"
          echo "â”‚   3. Enter the password above             â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

      - name: â³ MAINTAIN SESSION
        run: |
          case "${{ github.event.inputs.duration }}" in
            "1h") sleep 3600 ;;
            "3h") sleep 10800 ;;
            "5h40m") sleep 20400 ;;
          esac
          echo "ğŸ¯ TIME EXPIRED!"
